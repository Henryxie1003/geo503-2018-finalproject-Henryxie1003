<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Yuhao Xie" />


<title>Tracking tree phenology of Nature View Park in Buffalo</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/simplex.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
<script src="site_libs/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
<script src="site_libs/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 41px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 46px;
  margin-top: -46px;
}

.section h2 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h3 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h4 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h5 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h6 {
  padding-top: 46px;
  margin-top: -46px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R Data Science Final Project</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/adammwilson/RDataScience">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Tracking tree phenology of Nature View Park in Buffalo</h1>
<h4 class="author"><em>Yuhao Xie</em></h4>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<hr />
<p>Phenology has been proven as a sensitive and integrative indicator of climate variability and vegetation growth responses to climate change (X. Zhao, K. Tan, 2011). The understanding of phenology brings significant insight into both climate and vegetation interactions and their impacts on different spatial and temporal scales (Y. He, 2013). NDVI and EVI are two most widely used indexes in vegetation phenology study.This project aims at tracking phenology change of forest at Nature View Park in Buffalo in the past decade. Further analysis will estimate the Start of Season(SOS) and End of Season(EOS) for each year during the last decade illustrate a evidence of potential climate change.<br />
<br><br></p>
</div>
<div id="data-and-methods" class="section level1">
<h1>Data and methods</h1>
<hr />
<div id="data-acquisition" class="section level2">
<h2>Data acquisition</h2>
<p>The traditional way of monitoring forest phenology uses remote sensing data such as Landsat TM or MODIS data which is efficient in large-scale studies.</p>
<p>In this study, I use the Application for Extracting and Exploring Analysis Ready Samples(AρρEEARS) to download MODIS data.<a href="https://lpdaacsvc.cr.usgs.gov/appeears/">AρρEEARS</a> provides a simple and efficient way to access and transform geospatial data from a variety of federal data archives. It enables users to subset geospatial datasets using spatial, temporal, and band/layer parameters. Two types of sample requests are available: point samples for geographic coordinates and area samples for spatial areas via vector polygons.</p>
<p>This project bases on both two satellites of MODIS system, Aqua and Terra, to extract the NDVI of the Nature View Park in Buffalo. The 16-day NDVI layer of MODIS Vegetation Indices product are used. Each satellite provides global vegetation indices including NDVI, EVI and LAI every 16 days with 1km spatial resolution. But Aqua and Terra are on the two different orbits which let them have a 8 days interval between each other for visiting a same place. Thus, we can have 8 days interval NDVI data for the study area rely on combining data from both two satellites. The time period of data is from 01/01/2008 to 11/01/2018. AρρEEARS also provides API for submitting request and downloading data from R.</p>
<p>Load required packages for using AρρEEARS API and further wrangling on data(you may need to install some packages):</p>
<pre class="r"><code>library(httr)
library(jsonlite)
library(RCurl)
library(ggplot2)
library(dplyr)
library(lubridate)
knitr::opts_chunk$set(cache=TRUE)  # cache the results for quick compiling</code></pre>
<p><br></p>
<p>AρρEEARS API requires user to have an account and log in before use further functions. You can sign up an account on <a href="https://lpdaacsvc.cr.usgs.gov/appeears/">AρρEEARS website</a>. Since most of people visit this project don’t have account for that. I downloaded the required data by the code chunks below and pushed it to my github repository and provide codes in the next section for downloading data from my repository.<br />
For using the API, using the code below to log in with your username and password first and check the log in status.</p>
<pre class="r"><code>#log in the system with NASA EarthData account username and password
secret &lt;- base64_enc(paste(&quot;your username&quot;, &quot;password&quot;, sep = &quot;:&quot;))
response &lt;- POST(&quot;https://lpdaacsvc.cr.usgs.gov/appeears/api/login&quot;, 
                 add_headers(&quot;Authorization&quot; = paste(&quot;Basic&quot;, gsub(&quot;\n&quot;, &quot;&quot;, secret)),
                             &quot;Content-Type&quot; = &quot;application/x-www-form-urlencoded;charset=UTF-8&quot;), 
                 body = &quot;grant_type=client_credentials&quot;)

#check log in status
token_response &lt;- prettify(toJSON(content(response), auto_unbox = TRUE))
token_response
response_p &lt;- GET(&quot;https://lpdaacsvc.cr.usgs.gov/appeears/api/product&quot;)
product_response &lt;- toJSON(content(response_p), auto_unbox = TRUE)</code></pre>
<p><br></p>
<p>The API requires a JavaScript Object Notation(JSON) format task file for submitting a request. the task file should includes the sample type, period, product id and layer name. For point sample, only the geographic coordiates needed. Since the spatial resolution is 1km on MODIS data, one pixel of the image should be enough to cover the whole study area. As the task file below describes, the 16-days NDVI data of the study area with 1km resolution from both two satellites from 2008 to 2018 will be included in request. It can take a few seconds even minutes for completing the request.</p>
<pre class="r"><code># create a task request
task &lt;- &#39;{
          &quot;task_type&quot;: &quot;point&quot;,
&quot;task_name&quot;: &quot;my-task&quot;,
&quot;params&quot;:{
&quot;dates&quot;: [
{
  &quot;startDate&quot;: &quot;01-01-2008&quot;,
  &quot;endDate&quot;: &quot;11-01-2018&quot;
}],
  &quot;layers&quot;: [
  {
&quot;product&quot;: &quot;MOD13A2.006&quot;,
  &quot;layer&quot;: &quot;_1_km_16_days_NDVI&quot;
  },
  {
&quot;product&quot;: &quot;MYD13A2.006&quot;,
  &quot;layer&quot;: &quot;_1_km_16_days_NDVI&quot;
  }],
  &quot;coordinates&quot;: [
  {
  &quot;latitude&quot;: 43.0444,
  &quot;longitude&quot;: -78.7833
  }]
}
}&#39;
task &lt;- fromJSON(task)
task &lt;- toJSON(task, auto_unbox=TRUE)

#submit the task request
token &lt;- paste(&quot;Bearer&quot;, fromJSON(token_response)$token)
response &lt;- POST(&quot;https://lpdaacsvc.cr.usgs.gov/appeears/api/task&quot;, body = task, encode = &quot;json&quot;, 
                 add_headers(Authorization = token, &quot;Content-Type&quot; = &quot;application/json&quot;))
task_response &lt;- prettify(toJSON(content(response), auto_unbox = TRUE))
task_response</code></pre>
<p><br></p>
<p>The point sample requset results in two csv files including all the acquired data and quality descriptions. The API does not support bath download, a for loop is used to download both to csv files to the working directory.</p>
<pre class="r"><code>#check task bundle
token &lt;- paste(&quot;Bearer&quot;, fromJSON(token_response)$token)
response &lt;- GET(paste(&quot;https://lpdaacsvc.cr.usgs.gov/appeears/api/bundle/&quot;, task_id, sep = &quot;&quot;), add_headers(Authorization = token))
bundle_response &lt;- prettify(toJSON(content(response), auto_unbox = TRUE))
bundle_response

#Download file
#get csv file id and name
file_list&lt;-fromJSON(bundle_response)$files
file_id&lt;-file_list$file_id[file_list$file_type==&quot;csv&quot;]
file_name&lt;-file_list$file_name[file_list$file_type==&quot;csv&quot;]

# create a destination directory to store the file in
dest_dir &lt;- getwd()
filepath &lt;- paste(dest_dir, file_name, sep = &#39;/&#39;)
suppressWarnings(dir.create(dirname(filepath)))

# write the file to disk using the destination directory and file name 
for(i in 1:length(file_id)){
  response &lt;- GET(paste(&quot;https://lpdaacsvc.cr.usgs.gov/appeears/api/bundle/&quot;, task_id, &#39;/&#39;, file_id[i], sep = &quot;&quot;),
                write_disk(filepath[i], overwrite = TRUE), progress(), add_headers(Authorization = token))
  }

#read and view data
data&lt;-read.csv(file_name)
View(data)</code></pre>
<p><br><br></p>
</div>
<div id="methods" class="section level2">
<h2>Methods</h2>
<pre class="r"><code>#read data from my github repository
data1&lt;-read.csv(text=getURL(&quot;https://raw.githubusercontent.com/AdamWilsonLabEDU/geo503-2018-finalproject-Henryxie1003/master/my-task-MOD13A2-006-results.csv&quot;))
data2&lt;-read.csv(text=getURL(&quot;https://raw.githubusercontent.com/AdamWilsonLabEDU/geo503-2018-finalproject-Henryxie1003/master/my-task-MYD13A2-006-results.csv&quot;))</code></pre>
<p><br></p>
<pre class="r"><code>#data wrangling
#filter out cloudy pixel
data1_nonCloud&lt;-filter(data1,MOD13A2_006__1_km_16_days_VI_Quality_MODLAND!=&#39;0b10&#39;)
data2_nonCloud&lt;-filter(data2,MYD13A2_006__1_km_16_days_VI_Quality_MODLAND!=&#39;0b10&#39;)

#combine two data frame and rename column
data1_new&lt;-data1_nonCloud%&gt;%select(Date,MOD13A2_006__1_km_16_days_NDVI)
colnames(data1_new)[2]&lt;-&#39;NDVI&#39;
data2_new&lt;-data2_nonCloud%&gt;%select(Date,MYD13A2_006__1_km_16_days_NDVI)
colnames(data2_new)[2]&lt;-&#39;NDVI&#39;
data_combine&lt;-rbind(data1_new,data2_new)

#add year and number of days marker to each observation
data_combine$Year&lt;-substr(data_combine$Date,1,4)
data_combine$NumDays&lt;-yday(data_combine$Date)

#estimate SOS and EOS
SOS_range&lt;-data_combine%&gt;%filter(NumDays&gt;=50&amp;NumDays&lt;=150)
SOS&lt;-data.frame(Year=character(),SOS=double())
for (i in 2008:2018) {
  SOS_t&lt;-lm(NumDays~NDVI, SOS_range%&gt;%filter(Year==i))%&gt;%predict(data.frame(NDVI = c(0.5)))
  SOS&lt;-rbind(SOS,c(i,SOS_t))
}
names(SOS) &lt;- c(&quot;Year&quot;, &quot;SOS&quot;)
SOS$Year&lt;-as.character(SOS$Year)

EOS_range&lt;-data_combine%&gt;%filter(NumDays&gt;=250&amp;NumDays&lt;=350)
EOS&lt;-data.frame(Year=integer(),SOS=double())
for (i in 2008:2017) {
  EOS_t&lt;-lm(NumDays~NDVI, EOS_range%&gt;%filter(Year==i))%&gt;%predict(data.frame(NDVI = c(0.5)))
  EOS&lt;-rbind(EOS,c(i,EOS_t))
}
names(EOS) &lt;- c(&quot;Year&quot;, &quot;EOS&quot;)
EOS$Year&lt;-as.character(EOS$Year)</code></pre>
<p><br><br></p>
</div>
</div>
<div id="results" class="section level1">
<h1>Results</h1>
<hr />
<p>Show tables, plots, etc. and describe them. <img src="index_files/figure-html/unnamed-chunk-7-1.png" width="672" /><img src="index_files/figure-html/unnamed-chunk-7-2.png" width="672" /><img src="index_files/figure-html/unnamed-chunk-7-3.png" width="672" /> <br><br></p>
</div>
<div id="conclusions" class="section level1">
<h1>Conclusions</h1>
<hr />
<p><br><br></p>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<hr />
</div>

<!-- give the footer some space -->
<br/>
<br/>

<footer id="site-footer">
  <div id="footer1">
  This website is a project for Adam Wilson's <a href="http://www.adamwilson.us/RDataScience"><i> Spatial Data Science (GEO503) </i></a>Course at the University at Buffalo
  </div>
  <div id="footer2">
  <a rel="license" property="http://creativecommons.org/ns#license"
  href="http://creativecommons.org/licenses/by/4.0/" ><img src="img/cc-by.svg" alt="cc-by"/></a> 
  </div>
</footer>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>


</body>
</html>
